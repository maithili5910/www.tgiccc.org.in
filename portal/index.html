<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TGiCCC - Official Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Orbitron:wght@400;500;600;700;800;900&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #0047AB; --accent: #00D9FF; --success: #00E676;
            --warning: #FFD600; --danger: #FF1744; --dark: #0A0E27;
            --dark-card: #111936; --text: #E8EAED; --text-dim: #9AA0A6;
            --border: rgba(0, 217, 255, 0.2); --glow: rgba(0, 217, 255, 0.4);
            --sidebar-width: 280px; --header-height: 70px;
        }

        body {
            font-family: 'Inter', sans-serif; background: var(--dark);
            color: var(--text); overflow-x: hidden; line-height: 1.6;
        }

        .grid-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
            background: linear-gradient(90deg, rgba(0, 217, 255, 0.03) 1px, transparent 1px),
                        linear-gradient(rgba(0, 217, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px; animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .orb { position: fixed; border-radius: 50%; filter: blur(80px); opacity: 0.3; pointer-events: none; z-index: 1; }
        .orb-1 { width: 500px; height: 500px; background: radial-gradient(circle, var(--primary) 0%, transparent 70%); top: -250px; right: -250px; animation: float 15s ease-in-out infinite; }
        .orb-2 { width: 400px; height: 400px; background: radial-gradient(circle, var(--accent) 0%, transparent 70%); bottom: -200px; left: -200px; animation: float 12s ease-in-out infinite reverse; }

        @keyframes float { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(50px, 50px) scale(1.1); } }

        header { position: fixed; top: 0; left: 0; right: 0; height: var(--header-height); z-index: 1000; background: rgba(10, 14, 39, 0.95); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); }
        nav { height: 100%; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .nav-left { display: flex; align-items: center; gap: 2rem; }
        .hamburger { display: none; flex-direction: column; gap: 5px; cursor: pointer; padding: 0.5rem; }
        .hamburger span { width: 25px; height: 3px; background: var(--accent); border-radius: 2px; transition: all 0.3s ease; }
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(7px, -6px); }
        .logo { display: flex; align-items: center; gap: 0.75rem; font-family: 'Orbitron', sans-serif; font-size: 1.5rem; font-weight: 800; color: var(--accent); text-shadow: 0 0 20px var(--glow); letter-spacing: 2px; cursor: pointer; }
        .logo-emblem { width: 45px; height: 45px; background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; box-shadow: 0 0 30px var(--glow); border: 2px solid var(--accent); }
        .search-bar { display: flex; align-items: center; gap: 0.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 25px; padding: 0.5rem 1rem; min-width: 300px; transition: all 0.3s ease; }
        .search-bar:focus-within { background: rgba(255, 255, 255, 0.08); border-color: var(--accent); box-shadow: 0 0 20px var(--glow); }
        .search-bar input { background: transparent; border: none; color: var(--text); font-size: 0.9rem; width: 100%; outline: none; }
        .user-section { display: flex; align-items: center; gap: 1.5rem; }
        .btn-logout { padding: 0.6rem 1.5rem; background: transparent; border: 2px solid var(--danger); color: var(--danger); border-radius: 8px; cursor: pointer; font-weight: 700; transition: all 0.3s ease; text-transform: uppercase; }
        .btn-logout:hover { background: var(--danger); color: white; box-shadow: 0 0 20px rgba(255, 23, 68, 0.5); }
        .user-badge { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem 1rem; background: rgba(0, 217, 255, 0.1); border: 1px solid var(--accent); border-radius: 50px; cursor: pointer; transition: all 0.3s ease; }
        .user-badge:hover { background: rgba(0, 217, 255, 0.2); box-shadow: 0 0 20px var(--glow); }
        .user-avatar { width: 35px; height: 35px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--accent)); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 0.9rem; box-shadow: 0 0 20px var(--glow); border: 2px solid var(--accent); }
        
        .sidebar { position: fixed; left: 0; top: var(--header-height); width: var(--sidebar-width); height: calc(100vh - var(--header-height)); background: rgba(17, 25, 54, 0.95); backdrop-filter: blur(20px); border-right: 1px solid var(--border); padding: 2rem 0; overflow-y: auto; z-index: 900; transition: all 0.3s ease; }
        .sidebar::-webkit-scrollbar { width: 6px; }
        .sidebar::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        .sidebar::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }
        .sidebar-menu { list-style: none; }
        .sidebar-link { display: flex; align-items: center; gap: 1rem; padding: 1rem 2rem; color: var(--text-dim); text-decoration: none; transition: all 0.3s ease; position: relative; font-weight: 600; cursor: pointer; }
        .sidebar-link::before { content: ''; position: absolute; left: 0; top: 0; width: 4px; height: 100%; background: var(--accent); transform: scaleY(0); transition: transform 0.3s ease; }
        .sidebar-link:hover, .sidebar-link.active { color: var(--accent); background: rgba(0, 217, 255, 0.1); }
        .sidebar-link:hover::before, .sidebar-link.active::before { transform: scaleY(1); }
        .sidebar-icon { font-size: 1.5rem; width: 30px; text-align: center; }
        
        .main-content { margin-left: var(--sidebar-width); margin-top: var(--header-height); min-height: calc(100vh - var(--header-height)); padding: 3rem; position: relative; z-index: 10; }
        
        .home-page { margin: 0 !important; padding: 0 !important; min-height: 100vh; position: relative; display: flex; align-items: center; justify-content: center; }
        .home-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?q=80&w=2070'); background-size: cover; background-position: center; z-index: 1; }
        .home-bg::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(10, 14, 39, 0.95) 0%, rgba(0, 71, 171, 0.85) 50%, rgba(10, 14, 39, 0.95) 100%); }
        .home-content { position: relative; z-index: 10; text-align: center; max-width: 1200px; padding: 2rem; }
        .home-title { font-family: 'Orbitron', sans-serif; font-size: clamp(3rem, 8vw, 6rem); font-weight: 900; margin-bottom: 1rem; background: linear-gradient(135deg, white 0%, var(--accent) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: 4px; }
        .home-subtitle { font-size: clamp(1.2rem, 3vw, 2rem); color: var(--text); margin-bottom: 1rem; font-weight: 300; letter-spacing: 2px; text-transform: uppercase; }
        .home-features { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; margin: 3rem 0; }
        .feature-item { background: rgba(17, 25, 54, 0.6); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 15px; padding: 2rem; transition: all 0.3s ease; }
        .feature-item:hover { transform: translateY(-5px); border-color: var(--accent); box-shadow: 0 10px 40px var(--glow); }
        .feature-icon { font-size: 3rem; margin-bottom: 1rem; }
        .feature-title { font-size: 1.1rem; font-weight: 700; color: var(--accent); margin-bottom: 0.5rem; }
        .feature-desc { font-size: 0.9rem; color: var(--text-dim); }
        .btn-home-login { padding: 1.5rem 4rem; background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%); border: none; border-radius: 12px; color: white; font-size: 1.3rem; font-weight: 800; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 3px; box-shadow: 0 15px 50px rgba(0, 71, 171, 0.5); font-family: 'Orbitron', sans-serif; }
        .btn-home-login:hover { transform: translateY(-5px) scale(1.05); box-shadow: 0 20px 60px var(--glow); }

        .login-section { margin: 0 !important; padding: 8rem 2rem 2rem !important; display: none; min-height: 100vh; align-items: center; justify-content: center; position: relative; z-index: 10; }
        .login-section.active { display: flex; animation: fadeIn 0.6s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .login-container { max-width: 500px; width: 100%; }
        .login-header { text-align: center; margin-bottom: 3rem; }
        .login-header h1 { font-family: 'Orbitron', sans-serif; font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 900; margin-bottom: 0.5rem; background: linear-gradient(135deg, var(--accent) 0%, var(--primary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: 3px; }
        .login-card { background: rgba(17, 25, 54, 0.8); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 20px; padding: 3rem; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); }
        .back-button { display: inline-flex; align-items: center; gap: 0.5rem; color: var(--accent); font-weight: 600; cursor: pointer; margin-bottom: 2rem; transition: all 0.3s ease; }
        .back-button:hover { transform: translateX(-5px); }
        .security-badge { display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.8rem; background: rgba(0, 230, 118, 0.1); border: 1px solid var(--success); border-radius: 10px; margin-bottom: 2rem; font-size: 0.9rem; color: var(--success); font-weight: 600; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.7rem; font-weight: 700; font-size: 0.85rem; color: var(--accent); text-transform: uppercase; }
        .input-wrapper { position: relative; }
        .input-icon { position: absolute; left: 1.2rem; top: 50%; transform: translateY(-50%); color: var(--accent); font-size: 1.2rem; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 1.2rem 1.2rem 1.2rem 3.5rem; background: rgba(0, 0, 0, 0.3); border: 2px solid var(--border); border-radius: 10px; font-size: 1rem; color: var(--text); transition: all 0.3s ease; font-family: 'Inter', sans-serif; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: var(--accent); background: rgba(0, 0, 0, 0.5); box-shadow: 0 0 20px var(--glow); }
        .form-group input.error { border-color: var(--danger); }
        .error-message { color: var(--danger); font-size: 0.85rem; margin-top: 0.5rem; display: none; }
        .error-message.show { display: block; }
        .btn-login, .btn-primary { width: 100%; padding: 1.3rem; background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%); border: none; border-radius: 10px; color: white; font-size: 1.1rem; font-weight: 800; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 2px; box-shadow: 0 10px 30px rgba(0, 71, 171, 0.4); }
        .btn-login:hover, .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 15px 40px var(--glow); }
        .btn-login:disabled, .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .page { display: none; animation: fadeInUp 0.6s ease; }
        .page.active { display: block; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .page-header { margin-bottom: 3rem; display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 1rem; }
        .page-title { font-family: 'Orbitron', sans-serif; font-size: 2.5rem; font-weight: 900; color: var(--accent); margin-bottom: 0.5rem; text-transform: uppercase; }
        .page-subtitle { font-size: 1.1rem; color: var(--text-dim); }
        .breadcrumb { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: var(--text-dim); margin-bottom: 0.5rem; }
        .breadcrumb a { color: var(--accent); text-decoration: none; cursor: pointer; }
        .breadcrumb a:hover { text-decoration: underline; }
        
        .card { background: rgba(17, 25, 54, 0.6); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 20px; padding: 2rem; margin-bottom: 2rem; transition: all 0.3s ease; }
        .card:hover { border-color: rgba(0, 217, 255, 0.4); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin-bottom: 3rem; }
        .stat-card { background: rgba(17, 25, 54, 0.6); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 15px; padding: 2rem; position: relative; overflow: hidden; transition: all 0.3s ease; cursor: pointer; }
        .stat-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px; background: linear-gradient(90deg, var(--primary), var(--accent)); }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 40px rgba(0, 217, 255, 0.2); }
        .stat-icon { font-size: 2.5rem; margin-bottom: 1rem; }
        .stat-value { font-size: 2.5rem; font-weight: 900; color: var(--accent); font-family: 'Orbitron', sans-serif; margin-bottom: 0.5rem; animation: countUp 1s ease; }
        @keyframes countUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .stat-label { font-size: 0.9rem; color: var(--text-dim); text-transform: uppercase; }
        .stat-change { font-size: 0.85rem; margin-top: 0.5rem; }
        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--danger); }
        
        .quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .action-btn { background: rgba(17, 25, 54, 0.6); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 15px; padding: 1.5rem; display: flex; flex-direction: column; align-items: center; gap: 1rem; cursor: pointer; transition: all 0.3s ease; text-decoration: none; color: var(--text); }
        .action-btn:hover { transform: translateY(-5px); border-color: var(--accent); box-shadow: 0 10px 30px var(--glow); }
        .action-icon { font-size: 2.5rem; }
        .action-label { font-weight: 700; font-size: 0.95rem; text-align: center; }
        
        .directory-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; margin-top: 2rem; }
        .employee-card { background: rgba(17, 25, 54, 0.6); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 15px; padding: 2rem; text-align: center; transition: all 0.3s ease; }
        .employee-card:hover { transform: translateY(-5px); box-shadow: 0 10px 40px rgba(0, 217, 255, 0.2); border-color: var(--accent); }
        .employee-avatar-large { width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), var(--accent)); display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: 900; margin: 0 auto 1.5rem; border: 3px solid var(--accent); box-shadow: 0 0 30px var(--glow); }
        .employee-name { font-size: 1.2rem; font-weight: 700; color: var(--text); margin-bottom: 0.5rem; }
        .employee-role { font-size: 0.9rem; color: var(--accent); margin-bottom: 1rem; font-weight: 600; }
        .employee-contact { font-size: 0.85rem; color: var(--text-dim); line-height: 1.8; }
        
        .documents-list { display: grid; gap: 1rem; }
        .document-item { background: rgba(17, 25, 54, 0.6); backdrop-filter: blur(10px); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; display: flex; align-items: center; justify-content: space-between; transition: all 0.3s ease; cursor: pointer; }
        .document-item:hover { transform: translateX(5px); background: rgba(17, 25, 54, 0.8); border-color: var(--accent); }
        .document-info { display: flex; align-items: center; gap: 1.5rem; }
        .document-icon { width: 50px; height: 50px; border-radius: 10px; background: linear-gradient(135deg, rgba(0, 71, 171, 0.3), rgba(0, 217, 255, 0.3)); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .document-details h4 { font-size: 1.1rem; font-weight: 600; color: var(--text); margin-bottom: 0.3rem; }
        .document-meta { font-size: 0.85rem; color: var(--text-dim); }
        .btn-download { padding: 0.7rem 1.5rem; background: linear-gradient(135deg, var(--primary), var(--accent)); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .btn-download:hover { transform: translateY(-2px); box-shadow: 0 5px 20px var(--glow); }
        
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .gallery-item { position: relative; aspect-ratio: 16/10; border-radius: 15px; overflow: hidden; cursor: pointer; border: 2px solid var(--border); transition: all 0.3s ease; }
        .gallery-item:hover { transform: scale(1.05); box-shadow: 0 20px 40px rgba(0, 217, 255, 0.3); border-color: var(--accent); }
        .gallery-placeholder { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 4rem; background: linear-gradient(135deg, var(--dark-card), #1a2142); }
        .gallery-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: 1.5rem; background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent); }
        .gallery-title { font-size: 1.1rem; font-weight: 700; color: white; margin-bottom: 0.3rem; }
        .gallery-date { font-size: 0.85rem; color: var(--text-dim); }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 10000; align-items: center; justify-content: center; padding: 2rem; }
        .modal.active { display: flex; animation: fadeIn 0.3s ease; }
        .modal-content { background: rgba(17, 25, 54, 0.95); backdrop-filter: blur(20px); border: 2px solid var(--border); border-radius: 20px; padding: 2.5rem; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; }
        .modal-content::-webkit-scrollbar { width: 6px; }
        .modal-content::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        .modal-content::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid var(--border); }
        .modal-header h2 { font-family: 'Orbitron', sans-serif; font-size: 1.8rem; color: var(--accent); }
        .modal-close { background: transparent; border: 2px solid var(--danger); color: var(--danger); width: 40px; height: 40px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; transition: all 0.3s ease; }
        .modal-close:hover { background: var(--danger); color: white; transform: rotate(90deg); }
        
        .toast { position: fixed; top: 100px; right: 2rem; background: rgba(17, 25, 54, 0.98); border: 2px solid; border-radius: 12px; padding: 1.5rem; min-width: 300px; z-index: 10001; animation: slideInRight 0.3s ease; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7); display: flex; align-items: center; gap: 1rem; }
        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--danger); }
        .toast.warning { border-color: var(--warning); }
        .toast.info { border-color: var(--accent); }
        .toast-icon { font-size: 1.5rem; }
        .toast-content { flex: 1; }
        .toast-title { font-weight: 700; margin-bottom: 0.3rem; }
        .toast-message { font-size: 0.9rem; color: var(--text-dim); }
        @keyframes slideInRight { from { transform: translateX(500px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .admin-only { display: none; }
        .btn-add { padding: 0.9rem 2rem; background: linear-gradient(135deg, var(--success) 0%, #00C853 100%); border: none; border-radius: 10px; color: white; font-weight: 700; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; }
        .btn-add:hover { transform: translateY(-3px); box-shadow: 0 5px 20px rgba(0, 230, 118, 0.5); }
        .hidden { display: none !important; }
        
        .filter-bar { display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
        .filter-btn { padding: 0.7rem 1.5rem; background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border); border-radius: 8px; color: var(--text-dim); cursor: pointer; transition: all 0.3s ease; }
        .filter-btn.active, .filter-btn:hover { background: rgba(0, 217, 255, 0.1); border-color: var(--accent); color: var(--accent); }
        
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10, 14, 39, 0.95); z-index: 99999; display: none; align-items: center; justify-content: center; }
        .loading-overlay.active { display: flex; }
        .loader { width: 50px; height: 50px; border: 4px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .empty-state { text-align: center; padding: 4rem 2rem; color: var(--text-dim); }
        .empty-state-icon { font-size: 4rem; margin-bottom: 1rem; opacity: 0.5; }
        .empty-state-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--text); }
        .empty-state-message { font-size: 1rem; }

        @media (max-width: 1024px) {
            :root { --sidebar-width: 0px; }
            .sidebar { transform: translateX(-100%); }
            .sidebar.active { transform: translateX(0); box-shadow: 10px 0 30px rgba(0,0,0,0.5); }
            .main-content { margin-left: 0; }
            .hamburger { display: flex; }
            .search-bar { display: none; }
        }

        @media (max-width: 768px) {
            .main-content { padding: 2rem 1rem; }
            nav { padding: 0 1rem; }
            .logo { font-size: 1.2rem; }
            .logo-emblem { width: 35px; height: 35px; }
            .user-badge span { display: none; }
            .btn-logout { padding: 0.5rem 1rem; font-size: 0.75rem; }
            .stats-grid, .quick-actions, .directory-grid, .gallery-grid { grid-template-columns: 1fr; }
            .page-header { flex-direction: column; }
            .page-title { font-size: 2rem; }
            .toast { right: 1rem; left: 1rem; min-width: auto; }
            .modal-content { padding: 1.5rem; }
        }

        @media (max-width: 480px) {
            .home-title { font-size: 2.5rem; }
            .home-subtitle { font-size: 1rem; }
            .btn-home-login { padding: 1rem 2rem; font-size: 1rem; }
            .feature-item { padding: 1.5rem; }
        }
    </style>
</head>
<body>
    <div class="grid-background"></div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div style="text-align: center;">
            <div class="loader"></div>
            <p style="margin-top: 1rem; color: var(--accent);">Loading...</p>
        </div>
    </div>

    <header id="header" class="hidden">
        <nav>
            <div class="nav-left">
                <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
                <div class="logo" onclick="navigateTo('dashboard')">
                    <div class="logo-emblem">üèõÔ∏è</div><span>TGiCCC</span>
                </div>
                <div class="search-bar">
                    <span>üîç</span><input type="text" placeholder="Search everything..." id="globalSearch">
                </div>
            </div>
            <div class="user-section">
                <button class="btn-logout" onclick="logout()">Logout</button>
                <div class="user-badge" onclick="navigateTo('profile')">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <span id="userName">User</span>
                </div>
            </div>
        </nav>
    </header>

    <aside class="sidebar hidden" id="sidebar">
        <ul class="sidebar-menu">
            <li><a href="#" class="sidebar-link active" onclick="navigateTo('dashboard')"><span class="sidebar-icon">üìä</span><span>Dashboard</span></a></li>
            <li><a href="#" class="sidebar-link" onclick="navigateTo('notices')"><span class="sidebar-icon">üì¢</span><span>Notice Board</span></a></li>
            <li><a href="#" class="sidebar-link" onclick="navigateTo('events')"><span class="sidebar-icon">üìÖ</span><span>Events</span></a></li>
            <li><a href="#" class="sidebar-link" onclick="navigateTo('directory')"><span class="sidebar-icon">üë•</span><span>Directory</span></a></li>
            <li><a href="#" class="sidebar-link" onclick="navigateTo('documents')"><span class="sidebar-icon">üìÅ</span><span>Documents</span></a></li>
            <li><a href="#" class="sidebar-link" onclick="navigateTo('gallery')"><span class="sidebar-icon">üñºÔ∏è</span><span>Gallery</span></a></li>
            <li><a href="#" class="sidebar-link" onclick="navigateTo('analytics')"><span class="sidebar-icon">üìä</span><span>Analytics</span></a></li>
            <li><a href="#" class="sidebar-link" onclick="navigateTo('tasks')"><span class="sidebar-icon">‚úÖ</span><span>Task Manager</span></a></li>
            <li><a href="#" class="sidebar-link" onclick="navigateTo('chat')"><span class="sidebar-icon">üí¨</span><span>Messages</span></a></li>
            <li><a href="#" class="sidebar-link" onclick="navigateTo('attendance')"><span class="sidebar-icon">üïê</span><span>Attendance</span></a></li>
            <li><a href="#" class="sidebar-link" onclick="navigateTo('profile')"><span class="sidebar-icon">üë§</span><span>Profile</span></a></li>
        </ul>
    </aside>

    <section class="home-page main-content" id="homePage">
        <div class="home-bg"></div>
        <div class="home-content">
            <h1 class="home-title">TGiCCC</h1>
            <p class="home-subtitle">Telangana Integrated Command and Control Centre</p>
            <p style="font-size: 1.1rem; color: var(--text-dim); margin: 2rem auto 3rem; max-width: 800px; line-height: 1.8;">
                The nerve centre of smart governance ‚Äî enabling city-wide surveillance, emergency response, and intelligent coordination.
            </p>
            <div class="home-features">
                <div class="feature-item"><div class="feature-icon">üîí</div><div class="feature-title">Secure Access</div><div class="feature-desc">Military-grade encryption</div></div>
                <div class="feature-item"><div class="feature-icon">‚ö°</div><div class="feature-title">Real-time Systems</div><div class="feature-desc">24/7 operational status</div></div>
                <div class="feature-item"><div class="feature-icon">üåê</div><div class="feature-title">Integrated Network</div><div class="feature-desc">Seamless connectivity</div></div>
                <div class="feature-item"><div class="feature-icon">üõ°Ô∏è</div><div class="feature-title">Data Protection</div><div class="feature-desc">Classified information safe</div></div>
            </div>
            <button class="btn-home-login" onclick="showLoginPage()">üîê ACCESS PORTAL</button>
        </div>
    </section>

    <section class="login-section main-content" id="loginSection">
        <div class="login-container">
            <div class="login-header">
                <h1>TGiCCC</h1>
                <p style="font-size: 1.1rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 3px;">Secure Login</p>
            </div>
            <div class="login-card">
                <div class="back-button" onclick="showHome()">‚Üê Back to Home</div>
                <div class="security-badge">üîí SECURE CONNECTION</div>
                <div>
                    <div class="form-group">
                        <label>EMPLOYEE ID</label>
                        <div class="input-wrapper">
                            <span class="input-icon">üë§</span>
                            <input type="text" id="employeeId" placeholder="Enter ID">
                        </div>
                        <div class="error-message" id="employeeIdError">Invalid employee ID</div>
                    </div>
                    <div class="form-group">
                        <label>PASSWORD</label>
                        <div class="input-wrapper">
                            <span class="input-icon">üîë</span>
                            <input type="password" id="password" placeholder="Enter password" onkeypress="if(event.key==='Enter') handleLoginClick()">
                        </div>
                        <div class="error-message" id="passwordError">Invalid password</div>
                    </div>
                    <button type="button" class="btn-login" id="loginBtn" onclick="handleLoginClick()">ACCESS PORTAL</button>
                </div>
               </div>
        </div>
    </section>

    <div class="main-content page" id="dashboardPage">
        <div class="page-header">
            <div>
                <div class="breadcrumb">
                    <span>üè† Home</span> <span>‚Ä∫</span> <span>Dashboard</span>
                </div>
                <h1 class="page-title">COMMAND CENTER</h1>
                <p class="page-subtitle">Welcome back, <span id="dashboardUserName">Officer</span>! ‚Ä¢ <span id="currentDateTime"></span></p>
            </div>
        </div>
        <div class="stats-grid">
            <div class="stat-card" onclick="navigateTo('notices')">
                <div class="stat-icon">üì®</div>
                <div class="stat-value">24</div>
                <div class="stat-label">Unread Messages</div>
                <div class="stat-change positive">‚Üë 12% from yesterday</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìã</div>
                <div class="stat-value">08</div>
                <div class="stat-label">Pending Tasks</div>
                <div class="stat-change negative">‚Üì 3 completed today</div>
            </div>
            <div class="stat-card" onclick="navigateTo('directory')">
                <div class="stat-icon">üë•</div>
                <div class="stat-value">156</div>
                <div class="stat-label">Active Personnel</div>
                <div class="stat-change positive">‚Üë 4 online now</div>
            </div>
            <div class="stat-card" onclick="navigateTo('documents')">
                <div class="stat-icon">üìÅ</div>
                <div class="stat-value">42</div>
                <div class="stat-label">New Documents</div>
                <div class="stat-change positive">‚Üë 8 this week</div>
            </div>
        </div>

        <div class="card" id="incidentsPanel">
            <h3 style="margin-bottom:1.5rem; color: var(--accent);">üö® Active Incidents</h3>
            <div id="incidentsContainer"></div>
            <h4 style="margin-top:1.5rem; color: var(--text-dim); font-size: 1rem;">Recent Timeline</h4>
            <div id="incidentTimeline" style="color:var(--text-dim); font-size:0.95rem; margin-top:0.5rem;"></div>
        </div>
      
        <div class="card">
            <h3 style="margin-bottom: 1.5rem; color: var(--accent);">‚ö° Quick Actions</h3>
            <div class="quick-actions">
                <div class="action-btn" onclick="openIncidentModal()"><div class="action-icon">üö®</div><div class="action-label">Report Incident</div></div>
                <div class="action-btn" onclick="navigateTo('notices')"><div class="action-icon">üì¢</div><div class="action-label">View Notices</div></div>
                <div class="action-btn" onclick="navigateTo('events')"><div class="action-icon">üìÖ</div><div class="action-label">Check Events</div></div>
                <div class="action-btn" onclick="navigateTo('documents')"><div class="action-icon">üìÑ</div><div class="action-label">Documents</div></div>
                <div class="action-btn" onclick="navigateTo('profile')"><div class="action-icon">üë§</div><div class="action-label">My Profile</div></div>
            </div>
        </div>
    </div>

    <div class="main-content page" id="noticesPage">
        <div class="page-header">
            <div>
                <div class="breadcrumb">
                    <a onclick="navigateTo('dashboard')">üè† Home</a> <span>‚Ä∫</span> <span>Notice Board</span>
                </div>
                <h1 class="page-title">üì¢ NOTICE BOARD</h1>
                <p class="page-subtitle">Official announcements and updates</p>
            </div>
            <div class="admin-only">
                <button class="btn-add" onclick="showAddNoticeModal()">‚ûï Post Notice</button>
            </div>
        </div>
        <div class="filter-bar">
            <button class="filter-btn active" onclick="filterNotices('all')">All</button>
            <button class="filter-btn" onclick="filterNotices('high')">Urgent</button>
            <button class="filter-btn" onclick="filterNotices('medium')">Important</button>
            <button class="filter-btn" onclick="filterNotices('normal')">Normal</button>
        </div>
        <div id="noticesContainer"></div>
    </div>

    <div class="main-content page" id="eventsPage">
        <div class="page-header">
            <div>
                <div class="breadcrumb">
                    <a onclick="navigateTo('dashboard')">üè† Home</a> <span>‚Ä∫</span> <span>Events</span>
                </div>
                <h1 class="page-title">üìÖ EVENTS CALENDAR</h1>
                <p class="page-subtitle">Upcoming events and activities</p>
            </div>
            <div class="admin-only">
                <button class="btn-add" onclick="showAddEventModal()">‚ûï Create Event</button>
            </div>
        </div>
        <div class="gallery-grid" id="eventsContainer"></div>
    </div>

    <div class="main-content page" id="directoryPage">
        <div class="page-header">
            <div>
                <div class="breadcrumb">
                    <a onclick="navigateTo('dashboard')">üè† Home</a> <span>‚Ä∫</span> <span>Directory</span>
                </div>
                <h1 class="page-title">üë• EMPLOYEE DIRECTORY</h1>
                <p class="page-subtitle">Search and connect with team members</p>
            </div>
        </div>
        <div class="directory-grid">
            <div class="employee-card">
                <div class="employee-avatar-large">KR</div>
                <div class="employee-name">V.V.KAMALASAN REDDY</div>
                <div class="employee-role">Director</div>
                <div class="employee-contact">üìß director@tgiccc.gov<br>üìû +91-40-2345-6789</div>
            </div>
            <div class="employee-card">
                <div class="employee-avatar-large">KP</div>
                <div class="employee-name">K.PUSHPA</div>
                <div class="employee-role">SP TECH</div>
                <div class="employee-contact">üìß sptech@tgiccc.gov<br>üìû +91-40-2345-6790</div>
            </div>
            <div class="employee-card">
                <div class="employee-avatar-large">VR</div>
                <div class="employee-name">VENKAT REDDY</div>
                <div class="employee-role">Addl.SP</div>
                <div class="employee-contact">üìß addlsptech@tgiccc.gov<br>üìû +91-40-2345-6791</div>
            </div>
            <div class="employee-card">
                <div class="employee-avatar-large">NR</div>
                <div class="employee-name">M.NARSING RAO</div>
                <div class="employee-role">DSP TECH</div>
                <div class="employee-contact">üìß dsptech@tgiccc.gov<br>üìû +91-40-2345-6792</div>
            </div>
        </div>
    </div>

    <div class="main-content page" id="documentsPage">
        <div class="page-header">
            <div>
                <div class="breadcrumb">
                    <a onclick="navigateTo('dashboard')">üè† Home</a> <span>‚Ä∫</span> <span>Documents</span>
                </div>
                <h1 class="page-title">üìÅ DOCUMENTS</h1>
                <p class="page-subtitle">Access official documents</p>
            </div>
        </div>
        <div class="documents-list">
            <div class="document-item" onclick="showToast('success', 'Download Started', 'Annual Report 2024-2025.pdf')">
                <div class="document-info">
                    <div class="document-icon">üìÑ</div>
                    <div class="document-details">
                        <h4>Annual Report 2024-2025</h4>
                        <div class="document-meta">PDF ‚Ä¢ 4.2 MB ‚Ä¢ Updated 2 days ago</div>
                    </div>
                </div>
                <button class="btn-download" onclick="event.stopPropagation()">Download</button>
            </div>
            <div class="document-item" onclick="showToast('success', 'Download Started', 'Employee Handbook.pdf')">
                <div class="document-info">
                    <div class="document-icon">üìä</div>
                    <div class="document-details">
                        <h4>Employee Handbook</h4>
                        <div class="document-meta">PDF ‚Ä¢ 2.8 MB ‚Ä¢ Updated 1 week ago</div>
                    </div>
                </div>
                <button class="btn-download" onclick="event.stopPropagation()">Download</button>
            </div>
            <div class="document-item" onclick="showToast('success', 'Download Started', 'Security Protocols.pdf')">
                <div class="document-info">
                    <div class="document-icon">üîí</div>
                    <div class="document-details">
                        <h4>Security Protocols 2025</h4>
                        <div class="document-meta">PDF ‚Ä¢ 1.5 MB ‚Ä¢ Updated 3 days ago</div>
                    </div>
                </div>
                <button class="btn-download" onclick="event.stopPropagation()">Download</button>
            </div>
        </div>
    </div>

    <div class="main-content page" id="galleryPage">
        <div class="page-header">
            <div>
                <div class="breadcrumb">
                    <a onclick="navigateTo('dashboard')">üè† Home</a> <span>‚Ä∫</span> <span>Gallery</span>
                </div>
                <h1 class="page-title">üñºÔ∏è GALLERY</h1>
                <p class="page-subtitle">Photo gallery</p>
            </div>
        </div>
        <div class="gallery-grid">
            <div class="gallery-item" onclick="showToast('info', 'Gallery', 'Full view feature coming soon')">
                <div class="gallery-placeholder">üèõÔ∏è</div>
                <div class="gallery-overlay">
                    <div class="gallery-title">Annual Conference</div>
                    <div class="gallery-date">Oct 28, 2025 ‚Ä¢ 45 photos</div>
                </div>
            </div>
            <div class="gallery-item" onclick="showToast('info', 'Gallery', 'Full view feature coming soon')">
                <div class="gallery-placeholder">üéì</div>
                <div class="gallery-overlay">
                    <div class="gallery-title">Training Program</div>
                    <div class="gallery-date">Oct 15, 2025 ‚Ä¢ 32 photos</div>
                </div>
            </div>
            <div class="gallery-item" onclick="showToast('info', 'Gallery', 'Full view feature coming soon')">
                <div class="gallery-placeholder">üéâ</div>
                <div class="gallery-overlay">
                    <div class="gallery-title">Team Building Event</div>
                    <div class="gallery-date">Sep 20, 2025 ‚Ä¢ 67 photos</div>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content page" id="profilePage">
        <div class="page-header">
            <div>
                <div class="breadcrumb">
                    <a onclick="navigateTo('dashboard')">üè† Home</a> <span>‚Ä∫</span> <span>Profile</span>
                </div>
                <h1 class="page-title">üë§ MY PROFILE</h1>
                <p class="page-subtitle">Manage your personal information</p>
            </div>
        </div>
        <div class="card">
            <div style="text-align: center; margin-bottom: 2rem;">
                <div class="employee-avatar-large" style="width: 120px; height: 120px; font-size: 3rem;" id="profileAvatar">U</div>
            </div>
            <form onsubmit="updateProfile(event)">
                <div class="form-group">
                    <label>FULL NAME</label>
                    <div class="input-wrapper">
                        <span class="input-icon">üë§</span>
                        <input type="text" id="profileName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>EMAIL</label>
                    <div class="input-wrapper">
                        <span class="input-icon">üìß</span>
                        <input type="email" id="profileEmail" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>PHONE</label>
                    <div class="input-wrapper">
                        <span class="input-icon">üìû</span>
                        <input type="tel" id="profilePhone" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>DEPARTMENT</label>
                    <div class="input-wrapper">
                        <span class="input-icon">üè¢</span>
                        <input type="text" id="profileDepartment" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>CHANGE PASSWORD (leave blank to keep current)</label>
                    <div class="input-wrapper">
                        <span class="input-icon">üîë</span>
                        <input type="password" id="profilePassword" placeholder="New password">
                    </div>
                </div>
                <button type="submit" class="btn-primary">Update Profile</button>
            </form>
        </div>
    </div>

    <!-- Analytics Page -->
    <div class="main-content page" id="analyticsPage">
        <div class="page-header">
            <div>
                <div class="breadcrumb">
                    <a onclick="navigateTo('dashboard')">üè† Home</a> <span>‚Ä∫</span> <span>Analytics</span>
                </div>
                <h1 class="page-title">üìä ANALYTICS DASHBOARD</h1>
                <p class="page-subtitle">Data visualization and insights</p>
            </div>
            <div style="display: flex; gap: 1rem;">
                <select id="analyticsTimeRange" onchange="updateAnalytics()" style="padding: 0.7rem 1rem; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 8px; color: var(--text); cursor: pointer;">
                    <option value="7">Last 7 Days</option>
                    <option value="30" selected>Last 30 Days</option>
                    <option value="90">Last 90 Days</option>
                </select>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìà</div>
                <div class="stat-value">2,847</div>
                <div class="stat-label">Total Operations</div>
                <div class="stat-change positive">‚Üë 23% vs last month</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚è±Ô∏è</div>
                <div class="stat-value">4.2h</div>
                <div class="stat-label">Avg Response Time</div>
                <div class="stat-change positive">‚Üì 15% improvement</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value">94%</div>
                <div class="stat-label">Success Rate</div>
                <div class="stat-change positive">‚Üë 3% this month</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-value">89%</div>
                <div class="stat-label">Team Efficiency</div>
                <div class="stat-change positive">‚Üë 7% improvement</div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
            <div class="card">
                <h3 style="margin-bottom: 1.5rem; color: var(--accent);">üìä Incident Trends</h3>
                <canvas id="incidentChart" height="250"></canvas>
            </div>
            <div class="card">
                <h3 style="margin-bottom: 1.5rem; color: var(--accent);">üìà Department Performance</h3>
                <canvas id="departmentChart" height="250"></canvas>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
            <div class="card">
                <h3 style="margin-bottom: 1.5rem; color: var(--accent);">üéØ Task Completion Rate</h3>
                <canvas id="taskChart" height="250"></canvas>
            </div>
            <div class="card">
                <h3 style="margin-bottom: 1.5rem; color: var(--accent);">üë• Team Activity</h3>
                <canvas id="activityChart" height="250"></canvas>
            </div>
        </div>
    </div>

    <!-- Task Management Page -->
    <div class="main-content page" id="tasksPage">
        <div class="page-header">
            <div>
                <div class="breadcrumb">
                    <a onclick="navigateTo('dashboard')">üè† Home</a> <span>‚Ä∫</span> <span>Tasks</span>
                </div>
                <h1 class="page-title">‚úÖ TASK MANAGER</h1>
                <p class="page-subtitle">Assign and track tasks</p>
            </div>
            <button class="btn-add" onclick="showAddTaskModal()">‚ûï New Task</button>
        </div>

        <div class="filter-bar">
            <button class="filter-btn active" onclick="filterTasks('all')">All Tasks</button>
            <button class="filter-btn" onclick="filterTasks('pending')">Pending</button>
            <button class="filter-btn" onclick="filterTasks('in-progress')">In Progress</button>
            <button class="filter-btn" onclick="filterTasks('completed')">Completed</button>
        </div>

        <div id="tasksContainer"></div>
    </div>

    <!-- Chat/Messaging Page -->
    <div class="main-content page" id="chatPage">
        <div class="page-header">
            <div>
                <div class="breadcrumb">
                    <a onclick="navigateTo('dashboard')">üè† Home</a> <span>‚Ä∫</span> <span>Messages</span>
                </div>
                <h1 class="page-title">üí¨ MESSAGES</h1>
                <p class="page-subtitle">Internal communication</p>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 300px 1fr; gap: 2rem; height: calc(100vh - 250px);">
            <div class="card" style="overflow-y: auto;">
                <h3 style="margin-bottom: 1rem; color: var(--accent);">Contacts</h3>
                <div id="chatContactsList"></div>
            </div>
            <div class="card" style="display: flex; flex-direction: column;">
                <div id="chatHeader" style="padding-bottom: 1rem; border-bottom: 2px solid var(--border); margin-bottom: 1rem;">
                    <h3 style="color: var(--accent);">Select a conversation</h3>
                </div>
                <div id="chatMessages" style="flex: 1; overflow-y: auto; margin-bottom: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 10px;"></div>
                <div style="display: flex; gap: 1rem;">
                    <input type="text" id="messageInput" placeholder="Type a message..." style="flex: 1; padding: 1rem; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 10px; color: var(--text);" onkeypress="if(event.key==='Enter') sendMessage()">
                    <button class="btn-primary" onclick="sendMessage()" style="width: auto; padding: 1rem 2rem;">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Page -->
    <div class="main-content page" id="attendancePage">
        <div class="page-header">
            <div>
                <div class="breadcrumb">
                    <a onclick="navigateTo('dashboard')">üè† Home</a> <span>‚Ä∫</span> <span>Attendance</span>
                </div>
                <h1 class="page-title">üïê ATTENDANCE SYSTEM</h1>
                <p class="page-subtitle">Check-in/check-out tracking</p>
            </div>
        </div>

        <div class="card" style="text-align: center; padding: 3rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">üïê</div>
            <h2 style="font-size: 2rem; color: var(--accent); margin-bottom: 0.5rem;" id="attendanceTime"></h2>
            <p style="color: var(--text-dim); margin-bottom: 2rem;" id="attendanceDate"></p>
            
            <div id="attendanceStatus" style="margin-bottom: 2rem;"></div>
            
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <button class="btn-primary" onclick="checkIn()" id="checkInBtn" style="width: auto; padding: 1.5rem 3rem; font-size: 1.2rem;">
                    ‚úì CHECK IN
                </button>
                <button class="btn-add" onclick="checkOut()" id="checkOutBtn" style="width: auto; padding: 1.5rem 3rem; font-size: 1.2rem; display: none; background: var(--danger);">
                    ‚úó CHECK OUT
                </button>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-bottom: 1.5rem; color: var(--accent);">üìÖ Attendance History</h3>
            <div id="attendanceHistory"></div>
        </div>
    </div>

    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent"></div>
    </div>

    <script>
        // Initialize system
        function initializeSystem() {
            if (!localStorage.getItem('tgiccc_users')) {
                const users = [
                    {id: '1', employeeId: 'admin', password: 'admin123', name: 'System Administrator', role: 'admin', department: 'IT Operations', email: 'admin@tgiccc.gov', phone: '+91-40-2345-6789', avatar: 'SA'},
                    {id: '2', employeeId: 'EMP001', password: 'emp123', name: 'P. Sridhar', role: 'employee', department: 'Operations', email: 'sridharinsp@tgiccc.gov', phone: '+91-40-2345-6790', avatar: 'SR'}
                ];
                localStorage.setItem('tgiccc_users', JSON.stringify(users));
            }
            if (!localStorage.getItem('tgiccc_notices')) {
                const notices = [
                    {id: '1', title: 'System Maintenance', content: 'Scheduled maintenance on Nov 15, 2025 from 02:00 AM to 04:00 AM. All systems will be temporarily unavailable during this period.', priority: 'high', date: '2025-11-08T14:30:00', postedBy: 'Admin', department: 'IT'},
                    {id: '2', title: 'Security Update', content: 'New security protocols have been implemented across all systems. Please review the updated guidelines in your dashboard.', priority: 'medium', date: '2025-11-05T09:15:00', postedBy: 'Admin', department: 'Security'},
                    {id: '3', title: 'Holiday Notice', content: 'Office will remain closed on November 18, 2025 for public holiday. Emergency contact numbers will remain operational.', priority: 'normal', date: '2025-11-10T10:00:00', postedBy: 'HR', department: 'Administration'}
                ];
                localStorage.setItem('tgiccc_notices', JSON.stringify(notices));
            }
            if (!localStorage.getItem('tgiccc_events')) {
                const events = [
                    {id: '1', title: 'Annual Conference', description: 'Organization-wide annual conference with keynote speakers and team presentations.', date: '2025-11-25', time: '09:00', location: 'Main Auditorium'},
                    {id: '2', title: 'Training Workshop', description: 'Security awareness and cyber safety training for all personnel.', date: '2025-11-20', time: '14:00', location: 'Training Room A'},
                    {id: '3', title: 'Team Meeting', description: 'Monthly review and planning session for department heads.', date: '2025-11-18', time: '11:00', location: 'Conference Room 3'}
                ];
                localStorage.setItem('tgiccc_events', JSON.stringify(events));
            }
            updateDateTime();
            setInterval(updateDateTime, 60000);
        }

        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            const dateTimeEl = document.getElementById('currentDateTime');
            if (dateTimeEl) {
                dateTimeEl.textContent = now.toLocaleDateString('en-IN', options);
            }
        }

        // Toast notification system
        function showToast(type, title, message) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || '‚ÑπÔ∏è'}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
            `;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        let currentUser = null;
        let currentNoticeFilter = 'all';

        function showHome() {
            document.getElementById('homePage').classList.remove('hidden');
            document.getElementById('loginSection').classList.remove('active');
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        }

        function showLoginPage() {
            document.getElementById('homePage').classList.add('hidden');
            document.getElementById('loginSection').classList.add('active');
            setTimeout(() => {
                document.getElementById('employeeId').focus();
            }, 100);
        }

        function handleLoginClick() {
            const employeeId = document.getElementById('employeeId').value.trim();
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            
            // Clear previous errors
            document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
            document.querySelectorAll('.form-group input').forEach(el => el.classList.remove('error'));
            
            if (!employeeId || !password) {
                showToast('error', 'Login Failed', 'Please fill in all fields');
                return;
            }
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'AUTHENTICATING...';
            
            setTimeout(() => {
                const users = JSON.parse(localStorage.getItem('tgiccc_users') || '[]');
                const user = users.find(u => u.employeeId === employeeId && u.password === password);
                
                if (user) {
                    currentUser = user;
                    localStorage.setItem('tgiccc_currentUser', JSON.stringify(user));
                    
                    // Hide login, show portal
                    document.getElementById('homePage').classList.add('hidden');
                    document.getElementById('loginSection').classList.remove('active');
                    document.getElementById('header').classList.remove('hidden');
                    document.getElementById('sidebar').classList.remove('hidden');
                    
                    // Update user info
                    document.getElementById('userAvatar').textContent = user.avatar;
                    document.getElementById('userName').textContent = user.name;
                    document.getElementById('dashboardUserName').textContent = user.name;
                    
                    // Show/hide admin features
                    document.querySelectorAll('.admin-only').forEach(el => {
                        el.style.display = user.role === 'admin' ? 'block' : 'none';
                    });
                    
                    // Clear form
                    document.getElementById('employeeId').value = '';
                    document.getElementById('password').value = '';
                    
                    // Navigate to dashboard
                    navigateTo('dashboard');
                    showToast('success', 'Welcome!', `Logged in as ${user.name}`);
                } else {
                    showToast('error', 'Login Failed', 'Invalid credentials. Please try again.');
                    document.getElementById('employeeId').classList.add('error');
                    document.getElementById('password').classList.add('error');
                }
                
                loginBtn.disabled = false;
                loginBtn.textContent = 'ACCESS PORTAL';
            }, 800);
        }

        function handleLogin(event) {
            // Keep for compatibility but redirect to click handler
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            handleLoginClick();
            return false;
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                localStorage.removeItem('tgiccc_currentUser');
                document.getElementById('header').classList.add('hidden');
                document.getElementById('sidebar').classList.add('hidden');
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                showHome();
                showToast('info', 'Logged Out', 'You have been successfully logged out');
            }
        }

        function navigateTo(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(page + 'Page').classList.add('active');
            document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
            const link = document.querySelector(`[onclick*="navigateTo('${page}')"]`);
            if (link) link.classList.add('active');
            
            // Close sidebar on mobile after navigation
            if (window.innerWidth <= 1024) {
                document.getElementById('sidebar').classList.remove('active');
                document.getElementById('hamburger').classList.remove('active');
            }
            
            // Load page-specific content
            if (page === 'notices') loadNotices();
            if (page === 'events') loadEvents();
            if (page === 'profile') loadProfile();
            if (page === 'dashboard') renderIncidentsPanel();
            if (page === 'analytics') loadAnalytics();
            if (page === 'tasks') loadTasks();
            if (page === 'chat') loadChat();
            if (page === 'attendance') loadAttendance();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function filterNotices(priority) {
            currentNoticeFilter = priority;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            loadNotices();
        }

        function loadNotices() {
            const notices = JSON.parse(localStorage.getItem('tgiccc_notices') || '[]');
            const container = document.getElementById('noticesContainer');
            
            let filtered = notices;
            if (currentNoticeFilter !== 'all') {
                filtered = notices.filter(n => n.priority === currentNoticeFilter);
            }
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì¢</div>
                        <div class="empty-state-title">No Notices Found</div>
                        <div class="empty-state-message">There are no notices matching your filter.</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(n => `
                <div class="card" style="border-left: 4px solid ${n.priority === 'high' ? 'var(--danger)' : n.priority === 'medium' ? 'var(--warning)' : 'var(--success)'}">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
                        <h3 style="color: var(--text); font-size: 1.3rem; flex: 1;">${n.title}</h3>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <span style="padding: 0.4rem 1rem; border-radius: 20px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; background: rgba(${n.priority === 'high' ? '255,23,68' : n.priority === 'medium' ? '255,214,0' : '0,230,118'}, 0.2); border: 1px solid ${n.priority === 'high' ? 'var(--danger)' : n.priority === 'medium' ? 'var(--warning)' : 'var(--success)'}; color: ${n.priority === 'high' ? 'var(--danger)' : n.priority === 'medium' ? 'var(--warning)' : 'var(--success)'};">
                                ${n.priority === 'high' ? 'üî¥ URGENT' : n.priority === 'medium' ? 'üü° IMPORTANT' : 'üü¢ NOTICE'}
                            </span>
                            ${currentUser && currentUser.role === 'admin' ? `
                                <button onclick="editNotice('${n.id}')" style="padding: 0.5rem 1rem; background: var(--primary); border: none; border-radius: 8px; color: white; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">‚úèÔ∏è Edit</button>
                                <button onclick="deleteNotice('${n.id}')" style="padding: 0.5rem 1rem; background: var(--danger); border: none; border-radius: 8px; color: white; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">üóëÔ∏è Delete</button>
                            ` : ''}
                        </div>
                    </div>
                    <p style="color: var(--text-dim); line-height: 1.8; margin-bottom: 1rem;">${n.content}</p>
                    <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-dim); padding-top: 1rem; border-top: 1px solid var(--border); flex-wrap: wrap; gap: 0.5rem;">
                        <span>üìÖ ${new Date(n.date).toLocaleDateString('en-IN', {year: 'numeric', month: 'long', day: 'numeric'})}</span>
                        <span>üë§ ${n.postedBy} ‚Ä¢ ${n.department}</span>
                    </div>
                </div>
            `).join('');
        }

        function showAddNoticeModal() {
            document.getElementById('modalContent').innerHTML = `
                <div class="modal-header">
                    <h2>üì¢ Create Notice</h2>
                    <button class="modal-close" onclick="closeModal()">‚úï</button>
                </div>
                <form onsubmit="saveNotice(event)">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="noticeTitle" style="padding-left: 1.2rem;" required>
                    </div>
                    <div class="form-group">
                        <label>Content</label>
                        <textarea id="noticeContent" rows="5" style="padding: 1.2rem; resize: vertical;" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <select id="noticePriority" style="padding-left: 1.2rem;">
                            <option value="normal">Normal</option>
                            <option value="medium">Important</option>
                            <option value="high">Urgent</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-primary">Post Notice</button>
                </form>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function saveNotice(event) {
            event.preventDefault();
            const notices = JSON.parse(localStorage.getItem('tgiccc_notices') || '[]');
            const newNotice = {
                id: Date.now().toString(),
                title: document.getElementById('noticeTitle').value,
                content: document.getElementById('noticeContent').value,
                priority: document.getElementById('noticePriority').value,
                date: new Date().toISOString(),
                postedBy: currentUser.name,
                department: currentUser.department
            };
            notices.unshift(newNotice);
            localStorage.setItem('tgiccc_notices', JSON.stringify(notices));
            closeModal();
            loadNotices();
            showToast('success', 'Notice Posted', 'Your notice has been published successfully');
        }

        function deleteNotice(id) {
            if (confirm('Are you sure you want to delete this notice?')) {
                let notices = JSON.parse(localStorage.getItem('tgiccc_notices') || '[]');
                notices = notices.filter(n => n.id !== id);
                localStorage.setItem('tgiccc_notices', JSON.stringify(notices));
                loadNotices();
                showToast('success', 'Notice Deleted', 'Notice has been removed');
            }
        }

        function editNotice(id) {
            const notices = JSON.parse(localStorage.getItem('tgiccc_notices') || '[]');
            const notice = notices.find(n => n.id === id);
            if (!notice) return;
            
            document.getElementById('modalContent').innerHTML = `
                <div class="modal-header">
                    <h2>‚úèÔ∏è Edit Notice</h2>
                    <button class="modal-close" onclick="closeModal()">‚úï</button>
                </div>
                <form onsubmit="updateNotice(event, '${id}')">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="editTitle" value="${notice.title}" style="padding-left: 1.2rem;" required>
                    </div>
                    <div class="form-group">
                        <label>Content</label>
                        <textarea id="editContent" rows="5" style="padding: 1.2rem; resize: vertical;" required>${notice.content}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <select id="editPriority" style="padding-left: 1.2rem;">
                            <option value="normal" ${notice.priority === 'normal' ? 'selected' : ''}>Normal</option>
                            <option value="medium" ${notice.priority === 'medium' ? 'selected' : ''}>Important</option>
                            <option value="high" ${notice.priority === 'high' ? 'selected' : ''}>Urgent</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-primary">Update Notice</button>
                </form>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function updateNotice(event, id) {
            event.preventDefault();
            let notices = JSON.parse(localStorage.getItem('tgiccc_notices') || '[]');
            const index = notices.findIndex(n => n.id === id);
            if (index !== -1) {
                notices[index].title = document.getElementById('editTitle').value;
                notices[index].content = document.getElementById('editContent').value;
                notices[index].priority = document.getElementById('editPriority').value;
                localStorage.setItem('tgiccc_notices', JSON.stringify(notices));
            }
            closeModal();
            loadNotices();
            showToast('success', 'Notice Updated', 'Changes have been saved');
        }

        function loadEvents() {
            const events = JSON.parse(localStorage.getItem('tgiccc_events') || '[]');
            const container = document.getElementById('eventsContainer');
            
            if (events.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="empty-state-icon">üìÖ</div>
                        <div class="empty-state-title">No Events Scheduled</div>
                        <div class="empty-state-message">Check back later for upcoming events.</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = events.map(e => `
                <div class="gallery-item" onclick="viewEvent('${e.id}')">
                    <div class="gallery-placeholder">üìÖ</div>
                    <div class="gallery-overlay">
                        <div class="gallery-title">${e.title}</div>
                        <div class="gallery-date">${new Date(e.date).toLocaleDateString('en-IN')} ‚Ä¢ ${e.time}</div>
                        ${currentUser && currentUser.role === 'admin' ? `
                            <div style="margin-top: 0.5rem; display: flex; gap: 0.5rem;">
                                <button onclick="event.stopPropagation(); editEvent('${e.id}')" style="padding: 0.4rem 0.8rem; background: var(--primary); border: none; border-radius: 5px; color: white; cursor: pointer;">Edit</button>
                                <button onclick="event.stopPropagation(); deleteEvent('${e.id}')" style="padding: 0.4rem 0.8rem; background: var(--danger); border: none; border-radius: 5px; color: white; cursor: pointer;">Delete</button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function viewEvent(id) {
            const events = JSON.parse(localStorage.getItem('tgiccc_events') || '[]');
            const event = events.find(e => e.id === id);
            if (!event) return;
            
            document.getElementById('modalContent').innerHTML = `
                <div class="modal-header">
                    <h2>üìÖ ${event.title}</h2>
                    <button class="modal-close" onclick="closeModal()">‚úï</button>
                </div>
                <p style="margin-bottom: 1.5rem; line-height: 1.8; color: var(--text);">${event.description}</p>
                <div style="display: grid; gap: 1rem;">
                    <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 10px;">
                        <span style="font-size: 1.8rem;">üìÖ</span>
                        <div>
                            <div style="font-size: 0.85rem; color: var(--text-dim); text-transform: uppercase;">Date</div>
                            <div style="font-weight: 600; color: var(--text);">${new Date(event.date).toLocaleDateString('en-IN', {year: 'numeric', month: 'long', day: 'numeric'})}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 10px;">
                        <span style="font-size: 1.8rem;">üïê</span>
                        <div>
                            <div style="font-size: 0.85rem; color: var(--text-dim); text-transform: uppercase;">Time</div>
                            <div style="font-weight: 600; color: var(--text);">${event.time}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 10px;">
                        <span style="font-size: 1.8rem;">üìç</span>
                        <div>
                            <div style="font-size: 0.85rem; color: var(--text-dim); text-transform: uppercase;">Location</div>
                            <div style="font-weight: 600; color: var(--text);">${event.location}</div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function showAddEventModal() {
            document.getElementById('modalContent').innerHTML = `
                <div class="modal-header">
                    <h2>üìÖ Create Event</h2>
                    <button class="modal-close" onclick="closeModal()">‚úï</button>
                </div>
                <form onsubmit="saveEvent(event)">
                    <div class="form-group">
                        <label>Event Title</label>
                        <input type="text" id="eventTitle" style="padding-left: 1.2rem;" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="eventDescription" rows="4" style="padding: 1.2rem; resize: vertical;" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="eventDate" style="padding-left: 1.2rem;" required>
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" id="eventTime" style="padding-left: 1.2rem;" required>
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" id="eventLocation" style="padding-left: 1.2rem;" required>
                    </div>
                    <button type="submit" class="btn-primary">Create Event</button>
                </form>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function saveEvent(event) {
            event.preventDefault();
            const events = JSON.parse(localStorage.getItem('tgiccc_events') || '[]');
            const newEvent = {
                id: Date.now().toString(),
                title: document.getElementById('eventTitle').value,
                description: document.getElementById('eventDescription').value,
                date: document.getElementById('eventDate').value,
                time: document.getElementById('eventTime').value,
                location: document.getElementById('eventLocation').value,
                createdBy: currentUser.employeeId
            };
            events.unshift(newEvent);
            localStorage.setItem('tgiccc_events', JSON.stringify(events));
            closeModal();
            loadEvents();
            showToast('success', 'Event Created', 'New event has been added to the calendar');
        }

        function deleteEvent(id) {
            if (confirm('Delete this event?')) {
                let events = JSON.parse(localStorage.getItem('tgiccc_events') || '[]');
                events = events.filter(e => e.id !== id);
                localStorage.setItem('tgiccc_events', JSON.stringify(events));
                loadEvents();
                showToast('success', 'Event Deleted', 'Event has been removed');
            }
        }

        function editEvent(id) {
            const events = JSON.parse(localStorage.getItem('tgiccc_events') || '[]');
            const evt = events.find(e => e.id === id);
            if (!evt) return;
            
            document.getElementById('modalContent').innerHTML = `
                <div class="modal-header">
                    <h2>‚úèÔ∏è Edit Event</h2>
                    <button class="modal-close" onclick="closeModal()">‚úï</button>
                </div>
                <form onsubmit="updateEvent(event, '${id}')">
                    <div class="form-group">
                        <label>Event Title</label>
                        <input type="text" id="editEventTitle" value="${evt.title}" style="padding-left: 1.2rem;" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="editEventDescription" rows="4" style="padding: 1.2rem; resize: vertical;" required>${evt.description}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="editEventDate" value="${evt.date}" style="padding-left: 1.2rem;" required>
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" id="editEventTime" value="${evt.time}" style="padding-left: 1.2rem;" required>
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" id="editEventLocation" value="${evt.location}" style="padding-left: 1.2rem;" required>
                    </div>
                    <button type="submit" class="btn-primary">Update Event</button>
                </form>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function updateEvent(event, id) {
            event.preventDefault();
            let events = JSON.parse(localStorage.getItem('tgiccc_events') || '[]');
            const index = events.findIndex(e => e.id === id);
            if (index !== -1) {
                events[index].title = document.getElementById('editEventTitle').value;
                events[index].description = document.getElementById('editEventDescription').value;
                events[index].date = document.getElementById('editEventDate').value;
                events[index].time = document.getElementById('editEventTime').value;
                events[index].location = document.getElementById('editEventLocation').value;
                localStorage.setItem('tgiccc_events', JSON.stringify(events));
            }
            closeModal();
            loadEvents();
            showToast('success', 'Event Updated', 'Changes have been saved');
        }

        function loadProfile() {
            if (!currentUser) return;
            document.getElementById('profileAvatar').textContent = currentUser.avatar;
            document.getElementById('profileName').value = currentUser.name;
            document.getElementById('profileEmail').value = currentUser.email;
            document.getElementById('profilePhone').value = currentUser.phone;
            document.getElementById('profileDepartment').value = currentUser.department;
        }

        function updateProfile(event) {
            event.preventDefault();
            let users = JSON.parse(localStorage.getItem('tgiccc_users') || '[]');
            const index = users.findIndex(u => u.id === currentUser.id);
            
            if (index !== -1) {
                users[index].name = document.getElementById('profileName').value;
                users[index].email = document.getElementById('profileEmail').value;
                users[index].phone = document.getElementById('profilePhone').value;
                users[index].department = document.getElementById('profileDepartment').value;
                
                const newPassword = document.getElementById('profilePassword').value;
                if (newPassword) {
                    users[index].password = newPassword;
                }
                
                localStorage.setItem('tgiccc_users', JSON.stringify(users));
                currentUser = users[index];
                localStorage.setItem('tgiccc_currentUser', JSON.stringify(currentUser));
                
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('dashboardUserName').textContent = currentUser.name;
                
                showToast('success', 'Profile Updated', 'Your information has been saved successfully');
                document.getElementById('profilePassword').value = '';
            }
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // Incident Management
        function openIncidentModal() {
            const modalContent = document.getElementById('modalContent');
            if (!modalContent) return;
            
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h2>üö® Report Incident</h2>
                    <button class="modal-close" onclick="closeModal()">‚úï</button>
                </div>
                <form onsubmit="createIncident(event)">
                    <div class="form-group">
                        <label>Incident Title</label>
                        <input type="text" id="inc_title" required placeholder="Brief description" style="padding-left: 1.2rem;">
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" id="inc_location" required placeholder="Area / landmark" style="padding-left: 1.2rem;">
                    </div>
                    <div class="form-group">
                        <label>Severity</label>
                        <select id="inc_severity" style="padding-left: 1.2rem;">
                            <option value="critical">Critical</option>
                            <option value="major">Major</option>
                            <option value="minor">Minor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Details</label>
                        <textarea id="inc_notes" rows="4" placeholder="Describe the incident" style="padding: 1.2rem; resize: vertical;"></textarea>
                    </div>
                    <button type="submit" class="btn-primary">Submit Report</button>
                </form>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function createIncident(evt) {
            evt.preventDefault();
            const title = document.getElementById('inc_title').value.trim();
            const location = document.getElementById('inc_location').value.trim();
            const severity = document.getElementById('inc_severity').value;
            const notes = document.getElementById('inc_notes').value.trim();
            
            const incidents = JSON.parse(localStorage.getItem('tgiccc_incidents') || '[]');
            const incident = {
                id: Date.now().toString(),
                title, location, severity, notes,
                created: new Date().toISOString(),
                status: 'open',
                reportedBy: currentUser.name
            };
            
            incidents.unshift(incident);
            localStorage.setItem('tgiccc_incidents', JSON.stringify(incidents));
            
            closeModal();
            renderIncidentsPanel();
            addIncidentTimeline('Incident Reported', `${incident.title} at ${incident.location}`);
            showToast('success', 'Incident Reported', `${incident.title} has been logged`);
        }

        function renderIncidentsPanel() {
            const container = document.getElementById('incidentsContainer');
            const timelineEl = document.getElementById('incidentTimeline');
            if (!container) return;
            
            const incidents = JSON.parse(localStorage.getItem('tgiccc_incidents') || '[]').filter(i => i.status === 'open');
            
            if (!incidents.length) {
                container.innerHTML = '<div style="color:var(--text-dim); text-align: center; padding: 2rem;">No active incidents</div>';
                if (timelineEl) timelineEl.innerHTML = '';
                return;
            }
            
            container.innerHTML = incidents.map(inc => `
                <div style="display:flex; justify-content:space-between; gap:12px; align-items:flex-start; background:rgba(0,0,0,0.3); padding:1.5rem; border-radius:12px; border:1px solid var(--border); margin-bottom: 1rem;">
                    <div style="flex:1;">
                        <div style="font-weight:800; color:var(--accent); font-size: 1.1rem; margin-bottom: 0.5rem;">${inc.title}</div>
                        <div style="color:var(--text-dim); margin-bottom: 0.5rem;">üìç ${inc.location} ‚Ä¢ <span style="text-transform: uppercase; color: ${inc.severity === 'critical' ? 'var(--danger)' : inc.severity === 'major' ? 'var(--warning)' : 'var(--success)'};">${inc.severity}</span></div>
                        <div style="margin-top:0.8rem; color:var(--text-dim); font-size: 0.9rem;">${inc.notes || ''}</div>
                        <div style="margin-top:0.8rem; font-size: 0.85rem; color: var(--text-dim);">üìÖ ${new Date(inc.created).toLocaleString('en-IN')}</div>
                    </div>
                    <div style="display:flex; flex-direction:column; gap:8px;">
                        <button style="padding:0.7rem 1.2rem; background:var(--primary); border:none; border-radius:8px; color:white; cursor:pointer; font-weight: 600; transition: all 0.3s ease;" onclick="resolveIncident('${inc.id}')" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">‚úì Resolve</button>
                    </div>
                </div>
            `).join('');
            
            const timeline = JSON.parse(localStorage.getItem('tgiccc_incident_timeline') || '[]');
            if (timelineEl && timeline.length) {
                timelineEl.innerHTML = timeline.slice(0, 5).map(ev => `
                    <div style="margin-bottom:0.8rem; padding: 0.8rem; background: rgba(0,0,0,0.2); border-radius: 8px; border-left: 3px solid var(--accent);">
                        <div style="font-size: 0.85rem; color: var(--text-dim); margin-bottom: 0.3rem;">${new Date(ev.ts).toLocaleString('en-IN')}</div>
                        <div><strong style="color:var(--accent)">${ev.action}</strong>${ev.details ? ': ' + ev.details : ''}</div>
                    </div>
                `).join('');
            }
        }

        function resolveIncident(id) {
            if (confirm('Mark this incident as resolved?')) {
                const incidents = JSON.parse(localStorage.getItem('tgiccc_incidents') || '[]');
                const idx = incidents.findIndex(i => i.id === id);
                if (idx !== -1) {
                    incidents[idx].status = 'resolved';
                    incidents[idx].resolvedAt = new Date().toISOString();
                    incidents[idx].resolvedBy = currentUser.name;
                    localStorage.setItem('tgiccc_incidents', JSON.stringify(incidents));
                    addIncidentTimeline('Incident Resolved', incidents[idx].title);
                    showToast('success', 'Incident Resolved', 'Incident has been marked as resolved');
                    renderIncidentsPanel();
                }
            }
        }

        function addIncidentTimeline(action, details) {
            const arr = JSON.parse(localStorage.getItem('tgiccc_incident_timeline') || '[]');
            arr.unshift({ ts: new Date().toISOString(), action, details });
            if (arr.length > 50) arr.pop();
            localStorage.setItem('tgiccc_incident_timeline', JSON.stringify(arr));
            renderIncidentsPanel();
        }

        // Event Listeners
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') closeModal();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        document.getElementById('hamburger').addEventListener('click', function() {
            this.classList.toggle('active');
            document.getElementById('sidebar').classList.toggle('active');
        });

        // Global Search
        document.getElementById('globalSearch').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase().trim();
            if (query.length < 2) return;
            
            // Search in notices, events, etc.
            const notices = JSON.parse(localStorage.getItem('tgiccc_notices') || '[]');
            const events = JSON.parse(localStorage.getItem('tgiccc_events') || '[]');
            
            const noticeResults = notices.filter(n => 
                n.title.toLowerCase().includes(query) || 
                n.content.toLowerCase().includes(query)
            );
            
            const eventResults = events.filter(e => 
                e.title.toLowerCase().includes(query) || 
                e.description.toLowerCase().includes(query)
            );
            
            if (noticeResults.length > 0 || eventResults.length > 0) {
                showToast('info', 'Search Results', `Found ${noticeResults.length} notices and ${eventResults.length} events`);
            }
        });

        // Initialize on load
        window.addEventListener('load', () => {
            initializeSystem();
            initializeTasksData();
            initializeChatData();
            initializeAttendanceData();
            
            const savedUser = localStorage.getItem('tgiccc_currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('homePage').classList.add('hidden');
                document.getElementById('header').classList.remove('hidden');
                document.getElementById('sidebar').classList.remove('hidden');
                document.getElementById('userAvatar').textContent = currentUser.avatar;
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('dashboardUserName').textContent = currentUser.name;
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = currentUser.role === 'admin' ? 'block' : 'none';
                });
                navigateTo('dashboard');
            }
        });

        // ===== ANALYTICS FUNCTIONS =====
        let analyticsCharts = {};

        function loadAnalytics() {
            setTimeout(() => {
                createIncidentChart();
                createDepartmentChart();
                createTaskChart();
                createActivityChart();
            }, 100);
        }

        function createIncidentChart() {
            const ctx = document.getElementById('incidentChart');
            if (!ctx) return;
            
            if (analyticsCharts.incident) analyticsCharts.incident.destroy();
            
            analyticsCharts.incident = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Critical',
                        data: [12, 19, 8, 15],
                        borderColor: '#FF1744',
                        backgroundColor: 'rgba(255, 23, 68, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Major',
                        data: [18, 25, 20, 28],
                        borderColor: '#FFD600',
                        backgroundColor: 'rgba(255, 214, 0, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Minor',
                        data: [30, 45, 38, 42],
                        borderColor: '#00E676',
                        backgroundColor: 'rgba(0, 230, 118, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#E8EAED' } } },
                    scales: {
                        y: { ticks: { color: '#9AA0A6' }, grid: { color: 'rgba(0, 217, 255, 0.1)' } },
                        x: { ticks: { color: '#9AA0A6' }, grid: { color: 'rgba(0, 217, 255, 0.1)' } }
                    }
                }
            });
        }

        function createDepartmentChart() {
            const ctx = document.getElementById('departmentChart');
            if (!ctx) return;
            
            if (analyticsCharts.department) analyticsCharts.department.destroy();
            
            analyticsCharts.department = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Operations', 'IT', 'Security', 'Admin', 'Field'],
                    datasets: [{
                        label: 'Performance Score',
                        data: [85, 92, 78, 88, 95],
                        backgroundColor: ['#0047AB', '#00D9FF', '#00E676', '#FFD600', '#FF1744']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#E8EAED' } } },
                    scales: {
                        y: { ticks: { color: '#9AA0A6' }, grid: { color: 'rgba(0, 217, 255, 0.1)' }, max: 100 },
                        x: { ticks: { color: '#9AA0A6' }, grid: { color: 'rgba(0, 217, 255, 0.1)' } }
                    }
                }
            });
        }

        function createTaskChart() {
            const ctx = document.getElementById('taskChart');
            if (!ctx) return;
            
            if (analyticsCharts.task) analyticsCharts.task.destroy();
            
            analyticsCharts.task = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'In Progress', 'Pending'],
                    datasets: [{
                        data: [65, 25, 10],
                        backgroundColor: ['#00E676', '#FFD600', '#FF1744']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#E8EAED' } } }
                }
            });
        }

        function createActivityChart() {
            const ctx = document.getElementById('activityChart');
            if (!ctx) return;
            
            if (analyticsCharts.activity) analyticsCharts.activity.destroy();
            
            analyticsCharts.activity = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Active Users',
                        data: [120, 135, 128, 145, 142, 95, 88],
                        borderColor: '#00D9FF',
                        backgroundColor: 'rgba(0, 217, 255, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#E8EAED' } } },
                    scales: {
                        y: { ticks: { color: '#9AA0A6' }, grid: { color: 'rgba(0, 217, 255, 0.1)' } },
                        x: { ticks: { color: '#9AA0A6' }, grid: { color: 'rgba(0, 217, 255, 0.1)' } }
                    }
                }
            });
        }

        function updateAnalytics() {
            loadAnalytics();
            showToast('info', 'Analytics Updated', 'Data refreshed successfully');
        }

        // ===== TASK MANAGEMENT =====
        let currentTaskFilter = 'all';

        function initializeTasksData() {
            if (!localStorage.getItem('tgiccc_tasks')) {
                const tasks = [
                    {id: '1', title: 'Review Security Protocols', description: 'Update and review all security protocols', priority: 'high', status: 'pending', assignedTo: 'EMP001', dueDate: '2025-11-20', createdBy: 'admin', createdAt: new Date().toISOString()},
                    {id: '2', title: 'System Maintenance', description: 'Perform routine system maintenance', priority: 'medium', status: 'in-progress', assignedTo: 'EMP001', dueDate: '2025-11-18', createdBy: 'admin', createdAt: new Date().toISOString()},
                    {id: '3', title: 'Documentation Update', description: 'Update employee handbook', priority: 'normal', status: 'completed', assignedTo: 'admin', dueDate: '2025-11-15', createdBy: 'admin', createdAt: new Date().toISOString()}
                ];
                localStorage.setItem('tgiccc_tasks', JSON.stringify(tasks));
            }
        }

        function filterTasks(status) {
            currentTaskFilter = status;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            loadTasks();
        }

        function loadTasks() {
            const tasks = JSON.parse(localStorage.getItem('tgiccc_tasks') || '[]');
            const container = document.getElementById('tasksContainer');
            
            let filtered = tasks;
            if (currentTaskFilter !== 'all') {
                filtered = tasks.filter(t => t.status === currentTaskFilter);
            }
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚úÖ</div>
                        <div class="empty-state-title">No Tasks Found</div>
                        <div class="empty-state-message">No tasks match your filter.</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(task => {
                const priorityColors = {high: 'var(--danger)', medium: 'var(--warning)', normal: 'var(--success)'};
                const statusColors = {pending: 'var(--danger)', 'in-progress': 'var(--warning)', completed: 'var(--success)'};
                
                return `
                    <div class="card" style="border-left: 4px solid ${priorityColors[task.priority]}">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
                            <div style="flex: 1;">
                                <h3 style="color: var(--text); font-size: 1.3rem; margin-bottom: 0.5rem;">${task.title}</h3>
                                <p style="color: var(--text-dim); margin-bottom: 1rem;">${task.description}</p>
                                <div style="display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.9rem;">
                                    <span style="color: var(--text-dim);">üìÖ Due: ${new Date(task.dueDate).toLocaleDateString('en-IN')}</span>
                                    <span style="color: var(--text-dim);">üë§ Assigned: ${task.assignedTo}</span>
                                    <span style="padding: 0.3rem 0.8rem; border-radius: 15px; background: rgba(${task.priority === 'high' ? '255,23,68' : task.priority === 'medium' ? '255,214,0' : '0,230,118'}, 0.2); border: 1px solid ${priorityColors[task.priority]}; color: ${priorityColors[task.priority]}; text-transform: uppercase; font-size: 0.75rem; font-weight: 700;">
                                        ${task.priority}
                                    </span>
                                    <span style="padding: 0.3rem 0.8rem; border-radius: 15px; background: rgba(${task.status === 'pending' ? '255,23,68' : task.status === 'in-progress' ? '255,214,0' : '0,230,118'}, 0.2); border: 1px solid ${statusColors[task.status]}; color: ${statusColors[task.status]}; text-transform: uppercase; font-size: 0.75rem; font-weight: 700;">
                                        ${task.status.replace('-', ' ')}
                                    </span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                ${task.status !== 'completed' ? `<button onclick="updateTaskStatus('${task.id}', 'in-progress')" style="padding: 0.5rem 1rem; background: var(--warning); border: none; border-radius: 8px; color: white; cursor: pointer;">‚è≥ In Progress</button>` : ''}
                                ${task.status !== 'completed' ? `<button onclick="updateTaskStatus('${task.id}', 'completed')" style="padding: 0.5rem 1rem; background: var(--success); border: none; border-radius: 8px; color: white; cursor: pointer;">‚úì Complete</button>` : ''}
                                <button onclick="deleteTask('${task.id}')" style="padding: 0.5rem 1rem; background: var(--danger); border: none; border-radius: 8px; color: white; cursor: pointer;">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showAddTaskModal() {
            document.getElementById('modalContent').innerHTML = `
                <div class="modal-header">
                    <h2>‚úÖ Create New Task</h2>
                    <button class="modal-close" onclick="closeModal()">‚úï</button>
                </div>
                <div>
                    <div class="form-group">
                        <label>Task Title</label>
                        <input type="text" id="taskTitle" style="padding-left: 1.2rem;" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="taskDescription" rows="4" style="padding: 1.2rem; resize: vertical;"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <select id="taskPriority" style="padding-left: 1.2rem;">
                            <option value="normal">Normal</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Assign To</label>
                        <select id="taskAssign" style="padding-left: 1.2rem;">
                            <option value="admin">Admin</option>
                            <option value="EMP001">Amit Kumar</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Due Date</label>
                        <input type="date" id="taskDueDate" style="padding-left: 1.2rem;" required>
                    </div>
                    <button type="button" class="btn-primary" onclick="saveTask()">Create Task</button>
                </div>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function saveTask() {
            const tasks = JSON.parse(localStorage.getItem('tgiccc_tasks') || '[]');
            const newTask = {
                id: Date.now().toString(),
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                priority: document.getElementById('taskPriority').value,
                status: 'pending',
                assignedTo: document.getElementById('taskAssign').value,
                dueDate: document.getElementById('taskDueDate').value,
                createdBy: currentUser.employeeId,
                createdAt: new Date().toISOString()
            };
            tasks.unshift(newTask);
            localStorage.setItem('tgiccc_tasks', JSON.stringify(tasks));
            closeModal();
            loadTasks();
            showToast('success', 'Task Created', 'New task has been assigned');
        }

        function updateTaskStatus(id, status) {
            let tasks = JSON.parse(localStorage.getItem('tgiccc_tasks') || '[]');
            const idx = tasks.findIndex(t => t.id === id);
            if (idx !== -1) {
                tasks[idx].status = status;
                localStorage.setItem('tgiccc_tasks', JSON.stringify(tasks));
                loadTasks();
                showToast('success', 'Task Updated', `Task marked as ${status.replace('-', ' ')}`);
            }
        }

        function deleteTask(id) {
            if (confirm('Delete this task?')) {
                let tasks = JSON.parse(localStorage.getItem('tgiccc_tasks') || '[]');
                tasks = tasks.filter(t => t.id !== id);
                localStorage.setItem('tgiccc_tasks', JSON.stringify(tasks));
                loadTasks();
                showToast('success', 'Task Deleted', 'Task has been removed');
            }
        }

        // ===== CHAT/MESSAGING =====
        let currentChatUser = null;

        function initializeChatData() {
            if (!localStorage.getItem('tgiccc_messages')) {
                localStorage.setItem('tgiccc_messages', JSON.stringify({}));
            }
        }

        function loadChat() {
            const contacts = [
                {id: 'admin', name: 'System Administrator', avatar: 'SA', status: 'online'},
                {id: 'EMP001', name: 'Sridhar', avatar: 'SR', status: 'online'}
            ];
            
            const container = document.getElementById('chatContactsList');
            container.innerHTML = contacts.filter(c => c.id !== currentUser.employeeId).map(contact => `
                <div onclick="openChat('${contact.id}', '${contact.name}', '${contact.avatar}')" style="display: flex; align-items: center; gap: 1rem; padding: 1rem; margin-bottom: 0.5rem; background: rgba(0,0,0,0.2); border-radius: 10px; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(0,217,255,0.1)'" onmouseout="this.style.background='rgba(0,0,0,0.2)'">
                    <div style="position: relative;">
                        <div class="user-avatar" style="width: 45px; height: 45px; font-size: 1.1rem;">${contact.avatar}</div>
                        <div style="position: absolute; bottom: 0; right: 0; width: 12px; height: 12px; background: ${contact.status === 'online' ? 'var(--success)' : 'var(--text-dim)'}; border-radius: 50%; border: 2px solid var(--dark-card);"></div>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: var(--text);">${contact.name}</div>
                        <div style="font-size: 0.85rem; color: var(--text-dim);">${contact.status}</div>
                    </div>
                </div>
            `).join('');
        }

        function openChat(userId, userName, avatar) {
            currentChatUser = userId;
            document.getElementById('chatHeader').innerHTML = `
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div class="user-avatar" style="width: 45px; height: 45px; font-size: 1.1rem;">${avatar}</div>
                    <div>
                        <h3 style="color: var(--accent); margin: 0;">${userName}</h3>
                        <div style="font-size: 0.85rem; color: var(--success);">‚óè Online</div>
                    </div>
                </div>
            `;
            loadMessages();
        }

        function loadMessages() {
            const allMessages = JSON.parse(localStorage.getItem('tgiccc_messages') || '{}');
            const chatKey = [currentUser.employeeId, currentChatUser].sort().join('_');
            const messages = allMessages[chatKey] || [];
            
            const container = document.getElementById('chatMessages');
            if (messages.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-dim); padding: 2rem;">No messages yet. Start a conversation!</div>';
                return;
            }
            
            container.innerHTML = messages.map(msg => {
                const isMe = msg.from === currentUser.employeeId;
                return `
                    <div style="display: flex; ${isMe ? 'justify-content: flex-end' : 'justify-content: flex-start'}; margin-bottom: 1rem;">
                        <div style="max-width: 70%; padding: 1rem; background: ${isMe ? 'var(--primary)' : 'rgba(0,0,0,0.4)'}; border-radius: 15px; ${isMe ? 'border-bottom-right-radius: 5px' : 'border-bottom-left-radius: 5px'};">
                            <div style="color: var(--text);">${msg.text}</div>
                            <div style="font-size: 0.75rem; color: var(--text-dim); margin-top: 0.5rem; text-align: right;">${new Date(msg.timestamp).toLocaleTimeString('en-IN', {hour: '2-digit', minute: '2-digit'})}</div>
                        </div>
                    </div>
                `;
            }).join('');
            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            if (!currentChatUser) {
                showToast('warning', 'No Chat Selected', 'Please select a contact first');
                return;
            }
            
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text) return;
            
            const allMessages = JSON.parse(localStorage.getItem('tgiccc_messages') || '{}');
            const chatKey = [currentUser.employeeId, currentChatUser].sort().join('_');
            if (!allMessages[chatKey]) allMessages[chatKey] = [];
            
            allMessages[chatKey].push({
                from: currentUser.employeeId,
                to: currentChatUser,
                text: text,
                timestamp: new Date().toISOString()
            });
            
            localStorage.setItem('tgiccc_messages', JSON.stringify(allMessages));
            input.value = '';
            loadMessages();
        }

        // ===== ATTENDANCE SYSTEM =====
        function initializeAttendanceData() {
            if (!localStorage.getItem('tgiccc_attendance')) {
                localStorage.setItem('tgiccc_attendance', JSON.stringify([]));
            }
        }

        function loadAttendance() {
            updateAttendanceClock();
            setInterval(updateAttendanceClock, 1000);
            
            const attendance = JSON.parse(localStorage.getItem('tgiccc_attendance') || '[]');
            const today = new Date().toDateString();
            const todayRecord = attendance.find(a => a.userId === currentUser.id && new Date(a.checkIn).toDateString() === today);
            
            if (todayRecord && !todayRecord.checkOut) {
                document.getElementById('checkInBtn').style.display = 'none';
                document.getElementById('checkOutBtn').style.display = 'inline-block';
                document.getElementById('attendanceStatus').innerHTML = `
                    <div style="padding: 1.5rem; background: rgba(0,230,118,0.1); border: 2px solid var(--success); border-radius: 15px;">
                        <div style="font-size: 1.2rem; color: var(--success); font-weight: 700; margin-bottom: 0.5rem;">‚úì Checked In</div>
                        <div style="color: var(--text-dim);">Check-in time: ${new Date(todayRecord.checkIn).toLocaleTimeString('en-IN')}</div>
                    </div>
                `;
            } else if (todayRecord && todayRecord.checkOut) {
                document.getElementById('checkInBtn').style.display = 'none';
                document.getElementById('checkOutBtn').style.display = 'none';
                document.getElementById('attendanceStatus').innerHTML = `
                    <div style="padding: 1.5rem; background: rgba(0,217,255,0.1); border: 2px solid var(--accent); border-radius: 15px;">
                        <div style="font-size: 1.2rem; color: var(--accent); font-weight: 700; margin-bottom: 0.5rem;">‚úì Attendance Completed</div>
                        <div style="color: var(--text-dim);">
                            Check-in: ${new Date(todayRecord.checkIn).toLocaleTimeString('en-IN')}<br>
                            Check-out: ${new Date(todayRecord.checkOut).toLocaleTimeString('en-IN')}
                        </div>
                    </div>
                `;
            } else {
                document.getElementById('checkInBtn').style.display = 'inline-block';
                document.getElementById('checkOutBtn').style.display = 'none';
                document.getElementById('attendanceStatus').innerHTML = `
                    <div style="padding: 1.5rem; background: rgba(255,214,0,0.1); border: 2px solid var(--warning); border-radius: 15px;">
                        <div style="font-size: 1.2rem; color: var(--warning); font-weight: 700;">‚ö†Ô∏è Not Checked In</div>
                        <div style="color: var(--text-dim);">Please check in to start your day</div>
                    </div>
                `;
            }
            
            loadAttendanceHistory();
        }

        function updateAttendanceClock() {
            const now = new Date();
            document.getElementById('attendanceTime').textContent = now.toLocaleTimeString('en-IN');
            document.getElementById('attendanceDate').textContent = now.toLocaleDateString('en-IN', {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'});
        }

        function checkIn() {
            const attendance = JSON.parse(localStorage.getItem('tgiccc_attendance') || '[]');
            const today = new Date().toDateString();
            const existing = attendance.find(a => a.userId === currentUser.id && new Date(a.checkIn).toDateString() === today);
            
            if (existing) {
                showToast('warning', 'Already Checked In', 'You have already checked in today');
                return;
            }
            
            attendance.push({
                userId: currentUser.id,
                userName: currentUser.name,
                checkIn: new Date().toISOString(),
                checkOut: null
            });
            
            localStorage.setItem('tgiccc_attendance', JSON.stringify(attendance));
            showToast('success', 'Checked In', 'Attendance recorded successfully');
            loadAttendance();
        }

        function checkOut() {
            const attendance = JSON.parse(localStorage.getItem('tgiccc_attendance') || '[]');
            const today = new Date().toDateString();
            const idx = attendance.findIndex(a => a.userId === currentUser.id && new Date(a.checkIn).toDateString() === today && !a.checkOut);
            
            if (idx === -1) {
                showToast('error', 'Error', 'No check-in record found for today');
                return;
            }
            
            attendance[idx].checkOut = new Date().toISOString();
            localStorage.setItem('tgiccc_attendance', JSON.stringify(attendance));
            showToast('success', 'Checked Out', 'Have a great day!');
            loadAttendance();
        }

        function loadAttendanceHistory() {
            const attendance = JSON.parse(localStorage.getItem('tgiccc_attendance') || '[]');
            const userAttendance = attendance.filter(a => a.userId === currentUser.id).slice(0, 10);
            
            const container = document.getElementById('attendanceHistory');
            if (userAttendance.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-dim); padding: 2rem;">No attendance history</div>';
                return;
            }
            
            container.innerHTML = userAttendance.map(record => {
                const checkIn = new Date(record.checkIn);
                const checkOut = record.checkOut ? new Date(record.checkOut) : null;
                const duration = checkOut ? ((checkOut - checkIn) / (1000 * 60 * 60)).toFixed(1) : 'N/A';
                
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 10px; margin-bottom: 0.5rem;">
                        <div>
                            <div style="font-weight: 600; color: var(--text); margin-bottom: 0.3rem;">${checkIn.toLocaleDateString('en-IN', {weekday: 'long', month: 'short', day: 'numeric'})}</div>
                            <div style="font-size: 0.9rem; color: var(--text-dim);">
                                In: ${checkIn.toLocaleTimeString('en-IN', {hour: '2-digit', minute: '2-digit'})}
                                ${checkOut ? ` ‚Ä¢ Out: ${checkOut.toLocaleTimeString('en-IN', {hour: '2-digit', minute: '2-digit'})}` : ' ‚Ä¢ <span style="color: var(--warning);">Still Active</span>'}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.2rem; font-weight: 700; color: var(--accent);">${duration}h</div>
                            <div style="font-size: 0.85rem; color: var(--text-dim);">Duration</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Initialize on load
        window.addEventListener('load', () => {
            initializeSystem();
            
            const savedUser = localStorage.getItem('tgiccc_currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('homePage').classList.add('hidden');
                document.getElementById('header').classList.remove('hidden');
                document.getElementById('sidebar').classList.remove('hidden');
                document.getElementById('userAvatar').textContent = currentUser.avatar;
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('dashboardUserName').textContent = currentUser.name;
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = currentUser.role === 'admin' ? 'block' : 'none';
                });
                navigateTo('dashboard');
            }
        });

        // Auto-logout after 30 minutes of inactivity
        let inactivityTimer;
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            if (currentUser) {
                inactivityTimer = setTimeout(() => {
                    showToast('warning', 'Session Expired', 'You have been logged out due to inactivity');
                    setTimeout(logout, 2000);
                }, 30 * 60 * 1000);
            }
        }

        document.addEventListener('mousemove', resetInactivityTimer);
        document.addEventListener('keypress', resetInactivityTimer);
        document.addEventListener('click', resetInactivityTimer);
        document.addEventListener('scroll', resetInactivityTimer);

        // Prevent browser back button issues
        window.addEventListener('popstate', (e) => {
            if (!currentUser) {
                showHome();
            }
        });
    </script>
</body>
</html>